# nisshi-dev Survey — 要件定義・仕様

## 何をするアプリか

nisshi-dev Survey は **Google Forms の軽量版** のようなアンケート収集アプリ。
管理者がアンケートを作成し、固定 URL を共有して回答を集める。

## 想定ユーザー

| ロール | 説明 |
|---|---|
| 管理者 | アンケートの作成・回答の閲覧を行う。初期は自分1人だが、将来的に複数人管理を想定 |
| 回答者 | 共有された URL からアンケートに回答する。アカウント登録不要。誰でも何度でも回答可能 |

## ユーザーフロー

### 管理者

1. メール + パスワードでログイン
2. ダッシュボードでアンケートを作成（パラメータ定義も設定可能）
3. パラメータ定義がある場合、詳細画面でデータエントリ（値セット）を作成し、エントリ固有の URL を配布
4. 集まった回答をダッシュボードで閲覧（データエントリ単位でフィルタ・比較可能）

### 回答者

1. 配布された専用 URL（`/survey/:id?entry=:entryId`）にアクセス
2. アンケートに回答して送信
3. 完了

## 画面一覧

### 回答者向け

| パス | 画面 | 説明 |
|---|---|---|
| `/survey/:id` | アンケート回答ページ | 質問を表示し、回答を送信する |
| `/survey/:id/complete` | 回答完了ページ | 送信完了のメッセージを表示 |

### 管理者向け

| パス | 画面 | 説明 |
|---|---|---|
| `/admin/login` | ログインページ | メール + パスワードで認証 |
| `/admin` | ダッシュボード | アンケート一覧・回答閲覧 |
| `/admin/surveys/new` | アンケート作成ページ | 新規アンケートを作成 |
| `/admin/surveys/:id` | アンケート詳細ページ | 詳細表示・ステータス変更・削除 |
| `/admin/surveys/:id/edit` | アンケート編集ページ | タイトル・説明・質問を編集（active/completed は質問変更不可） |

## データモデル

| モデル | 説明 |
|---|---|
| Survey | アンケート。タイトル・説明（Markdown、任意）・ステータス（draft/active/completed）・質問定義・パラメータ定義を持つ |
| SurveyDataEntry | データエントリ。Survey のパラメータ定義に基づく値セット。エントリごとに固有の URL を発行して配布する |
| Response | 回答。どのアンケート・データエントリに対する回答かを紐付け。パラメータ値も非正規化して保存 |
| AdminUser | 管理者アカウント。メールアドレスとパスワード |
| Session | ログインセッション。有効期限付き |

### パラメータ

Survey にはパラメータ定義を設定できる。パラメータは URL クエリパラメータとしてアンケート URL に埋め込まれ、回答と一緒に保存される。

| フィールド | 型 | 説明 |
|---|---|---|
| key | string | URL パラメータ名（英数字 + `_` `-` のみ） |
| label | string | 管理画面・回答画面での表示名 |
| visible | boolean | `true` の場合、回答者に読み取り専用で表示される |

例: `?version=v2&event_date=2026-02-15` のような URL を配布し、どのバージョン・イベントの回答かを識別する。

### リレーション

```
Survey 1 ──→ * SurveyDataEntry
Survey 1 ──→ * Response
SurveyDataEntry 1 ──→ * Response
AdminUser 1 ──→ * Session
```

## 認証方式

| 対象 | 方式 |
|---|---|
| 回答者 | 認証なし。URL を知っていれば誰でも回答可能 |
| 管理者 | メール + パスワード → セッション Cookie |
